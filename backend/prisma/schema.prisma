generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:mysql@localhost:3306/testdb"
}

model Employees {
  employeeId   Int     @id @default(autoincrement())
  role         String  @default("staff")
  email        String  @unique
  supervisorId Int?
  firstName    String
  lastName     String
  password     String
  matricule    String? @unique
  jobTitle     String

  supervisor   Employees?  @relation("Supervisor", fields: [supervisorId], references: [employeeId])
  subordinates Employees[] @relation("Supervisor")

  evaluations360          Evaluation360[]
  evaluation360Supervisor Evaluation360[] @relation("Supervisor")
  evaluation360Evaluator  Evaluator360[]

  objectives           Objectives[]
  objectivesSupervisor Objectives[] @relation("Supervisor")

  evaluations           Evaluations[]
  evaluationsSupervisor Evaluations[]       @relation("Supervisor")
  comments              ObjectiveComments[]
  updates               Updates[]
}

model Evaluations {
  evaluationId       Int      @id @default(autoincrement())
  employeeId         Int
  supervisorId       Int
  supervisorJobTitle String
  evaluationYear     String   @default("2024")
  evaluationStatus   String   @default("draft")
  updatedAt          DateTime @updatedAt
  createdAt          DateTime @default(now())

  efficiency           String?
  efficiencyRating     Int?
  competency           String?
  competencyRating     Int?
  commitment           String?
  commitmentRating     Int?
  initiative           String?
  initiativeRating     Int?
  respect              String?
  respectRating        Int?
  leadership           String?
  leadershipRating     Int?
  selfEvaluationStatus String
  selfEfficiency       String?
  selfCompetency       String?
  selfCommitment       String?
  selfInitiative       String?
  selfRespect          String?
  selfLeadership       String?

  employee   Employees @relation(fields: [employeeId], references: [employeeId])
  supervisor Employees @relation("Supervisor", fields: [supervisorId], references: [employeeId])
}

model Evaluation360 {
  evaluation360Id  Int    @id @default(autoincrement())
  employeeId       Int
  supervisorId     Int
  evaluationYear   String @default("2024")
  evaluationStatus String @default("draft")

  employee   Employees      @relation(fields: [employeeId], references: [employeeId])
  supervisor Employees      @relation("Supervisor", fields: [supervisorId], references: [employeeId])
  evaluators Evaluator360[]
}

model Evaluator360 {
  evaluator360Id    Int     @id @default(autoincrement())
  evaluationId      Int
  evaluatorId       Int
  evaluatorJobTitle String
  evaluatorGrade    Int?
  evaluatorComment  String?

  evaluation Evaluation360 @relation(fields: [evaluationId], references: [evaluation360Id])
  evaluator  Employees     @relation(fields: [evaluatorId], references: [employeeId])
}

model Objectives {
  objectiveId          Int      @id @default(autoincrement())
  status               String   @default("draft")
  objectiveYear        String   @default("2024")
  employeeId           Int
  supervisorId         Int?
  evaluationStatus     String   @default("draft")
  selfEvaluationStatus String   @default("draft")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  title             String?
  description       String?
  successConditions String?
  deadline          String?
  kpi               String?
  grade             Int?
  comment           String?
  selfComment       String?

  employee         Employees           @relation(fields: [employeeId], references: [employeeId])
  supervisor       Employees?          @relation("Supervisor", fields: [supervisorId], references: [employeeId])
  ObjectiveComment ObjectiveComments[]
}

model Steps {
  stepId   Int     @id @default(autoincrement())
  name     String
  message  String
  active   Boolean @default(false)
  dateFrom String?
  dateTo   String?
  sent     Boolean @default(false)
}

model ObjectiveComments {
  commentId   Int      @id @default(autoincrement())
  objectiveId Int
  authorId    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  content     String

  objective Objectives @relation(fields: [objectiveId], references: [objectiveId])
  author    Employees  @relation(fields: [authorId], references: [employeeId])
}

model Updates {
  updateId   Int        @id @default(autoincrement())
  employeeId Int
  type       UpdateType
  employee   Employees  @relation(fields: [employeeId], references: [employeeId])
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @default(now()) @updatedAt
}

enum UpdateType {
  OBJECTIVE_SUBMIT
  OBJECTIVE_VALID
  OBJECTIVE_INVALID
}
